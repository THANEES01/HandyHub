<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title><%= title %> - HandyHub</title> 
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"> <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet"> 
        
        
    <style> 
    :root { 
        --primary-blue: #0077be; 
        --secondary-blue: #00a2e8; 
        --dark-blue: #003366; --light-blue: #e6f2ff; 
        --sidebar-width: 250px; 
    }
    
    body {
        min-height: 100vh;
        background-color: #f8f9fa;
    }

    /* Sidebar Styling */
    .sidebar {
        width: var(--sidebar-width);
        background-color: var(--dark-blue);
        min-height: 100vh;
        position: fixed;
        left: 0;
        top: 0;
        padding-top: 20px;
    }
    
    .sidebar-brand {
        color: white;
        font-size: 1.5rem;
        padding: 20px;
        text-decoration: none;
        display: block;
        margin-bottom: 20px;
    }
    
    .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 12px 20px;
        margin: 4px 0;
        transition: all 0.3s ease;
    }
    
    .nav-link:hover, .nav-link.active {
        color: white;
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    .nav-link i {
        margin-right: 10px;
    }
    
    /* Main Content Styling */
    .main-content {
        margin-left: var(--sidebar-width);
        padding: 30px;
    }

    /* Data section similar to dashboard */
    .data-section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    .section-title {
        font-size: 1.5rem;
        color: var(--dark-blue);
        margin-bottom: 20px;
    }

    /* Stats cards */
    .stats-card {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        padding: 20px;
        margin-bottom: 20px;
    }

    .stats-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-blue);
        text-align: center;
    }

    .stats-label {
        color: #6c757d;
        font-size: 1rem;
        text-align: center;
    }

    /* Review cards */
    .review-card {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        padding: 20px;
        margin-bottom: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid #eee;
    }

    .review-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .reviewer-info {
        display: flex;
        align-items: center;
    }

    .avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background-color: var(--primary-blue);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: 600;
        margin-right: 15px;
    }

    .reviewer-name {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 3px;
    }

    .reviewer-date {
        color: #6c757d;
        font-size: 0.85rem;
    }

    .review-service {
        font-size: 0.9rem;
        color: #495057;
        margin-top: 5px;
    }

    .review-rating {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
    }

    .star-rating {
        margin-bottom: 5px;
    }

    .star-rating i {
        color: #ffc107;
    }

    .review-booking-id {
        font-size: 0.85rem;
        color: #6c757d;
    }

    .review-content {
        margin-top: 15px;
        font-size: 1rem;
        line-height: 1.6;
        color: #343a40;
    }

    .empty-reviews {
        text-align: center;
        padding: 50px 20px;
    }

    .empty-reviews i {
        font-size: 4rem;
        color: #dee2e6;
        margin-bottom: 20px;
    }

    .empty-reviews h4 {
        color: #343a40;
        margin-bottom: 10px;
    }

    .empty-reviews p {
        color: #6c757d;
        max-width: 500px;
        margin: 0 auto;
    }

    /* Rating overview */
    .rating-overview {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        flex-direction: column;
    }

    .rating-value {
        font-size: 4rem;
        font-weight: 700;
        color: var(--primary-blue);
        line-height: 1;
    }

    .rating-stars {
        margin: 10px 0;
    }

    .rating-stars i {
        color: #ffc107;
        font-size: 1.5rem;
        margin-right: 5px;
    }

    .rating-count {
        color: #6c757d;
        font-size: 1rem;
        margin-bottom: 20px;
    }

    .progress-container {
        width: 100%;
        margin-bottom: 10px;
    }

    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
    }

    .progress-bar {
        background-color: var(--primary-blue);
    }

    .progress {
        height: 10px;
        border-radius: 5px;
    }

    /* Table styling */
    .pricing-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .pricing-table th {
        background-color: var(--primary-blue);
        color: white;
        font-weight: 600;
        padding: 12px 15px;
        text-align: left;
    }
    
    .pricing-table td {
        padding: 12px 15px;
        border-top: 1px solid #dee2e6;
        background-color: white;
    }
    
    .pricing-table tr:nth-child(even) td {
        background-color: var(--light-blue);
    }
</style>
</head> <body> <!-- Sidebar --> <div class="sidebar"> <a href="/provider/dashboard" class="sidebar-brand"> <i class="bi bi-tools"></i> HandyHub Provider </a> <nav class="nav flex-column"> <a class="nav-link <%= currentPage === 'dashboard' ? 'active' : '' %>" href="/provider/dashboard"> <i class="bi bi-person"></i> Profile </a> <a class="nav-link <%= currentPage === 'bookings' ? 'active' : '' %>" href="/provider/bookings"> <i class="bi bi-calendar-check"></i> Bookings </a> <a class="nav-link <%= currentPage === 'reviews' ? 'active' : '' %>" href="/provider/reviews"> <i class="bi bi-star"></i> Reviews & Ratings </a> <a class="nav-link <%= currentPage === 'earnings' ? 'active' : '' %>" href="/provider/earnings"> <i class="bi bi-wallet2"></i> Earnings </a> <a class="nav-link text-danger" href="/auth/logout"> <i class="bi bi-box-arrow-right"></i> Logout </a> </nav> </div>
<!-- Main Content -->
<div class="main-content">
    <!-- Messages Section -->
    <% if (locals.success) { %>
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <%= success %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    <% } %>

    <% if (locals.error) { %>
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <%= error %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    <% } %>

    <!-- Page Header -->
    <h2 class="mb-4">Reviews & Ratings</h2>

    <!-- Stats Section -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stats-card">
                <div class="stats-value"><%= averageRating %></div>
                <div class="rating-stars d-flex justify-content-center">
                    <% const avgRating = parseFloat(averageRating); %>
                    <% for(let i = 1; i <= 5; i++) { %>
                        <% if (i <= Math.floor(avgRating)) { %>
                            <i class="bi bi-star-fill"></i>
                        <% } else if (i <= Math.floor(avgRating) + 0.5 && i > Math.floor(avgRating)) { %>
                            <i class="bi bi-star-half"></i>
                        <% } else { %>
                            <i class="bi bi-star"></i>
                        <% } %>
                    <% } %>
                </div>
                <div class="stats-label">Average Rating</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <div class="stats-value"><%= reviewCount %></div>
                <div class="stats-label">Total Reviews</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <div class="stats-value"><%= reviewCount > 0 ? Math.round((ratingBreakdown[4] / reviewCount) * 100) : 0 %>%</div>
                <div class="stats-label">5-Star Reviews</div>
            </div>
        </div>
    </div>

    <!-- Rating Breakdown Section -->
    <div class="data-section">
        <h3 class="section-title">
            <i class="bi bi-bar-chart-fill"></i> Rating Breakdown
        </h3>
        
        <% if (reviewCount > 0) { %>
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <% for (let i = 5; i >= 1; i--) { %>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span><%= i %> <i class="bi bi-star-fill" style="color: #ffc107; font-size: 0.9rem;"></i></span>
                            <span>
                                <%= ratingBreakdown[i-1] || 0 %> 
                                review<%= (ratingBreakdown[i-1] === 1) ? '' : 's' %>
                            </span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: <%= ratingPercentages[i-1] || 0 %>%"></div>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    <% } else { %>
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            No reviews yet. Rating breakdown will be available once you receive reviews.
        </div>
    <% } %>
    </div>

    <!-- Reviews List Section -->
    <div class="data-section">
        <h3 class="section-title">
            <i class="bi bi-chat-square-text"></i> Customer Reviews
        </h3>
        
        <% if (reviews && reviews.length > 0) { %>
            <% reviews.forEach(review => { %>
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="avatar">
                                <%= review.first_name ? review.first_name.charAt(0).toUpperCase() : 'C' %>
                            </div>
                            <div>
                                <div class="reviewer-name">
                                    <%= review.first_name %> <%= review.last_name ? review.last_name.charAt(0) + '.' : '' %>
                                </div>
                                <div class="reviewer-date">
                                    <%= new Date(review.created_at).toLocaleDateString('en-US', {
                                        year: 'numeric',
                                        month: 'short',
                                        day: 'numeric'
                                    }) %>
                                </div>
                                <div class="review-service">
                                    <i class="bi bi-tools me-1"></i> 
                                    <%= review.service_type || 'Service' %> 
                                    <% if (review.preferred_date) { %>
                                        on <%= new Date(review.preferred_date).toLocaleDateString('en-US', {
                                            year: 'numeric',
                                            month: 'short',
                                            day: 'numeric'
                                        }) %>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                        <div class="review-rating">
                            <div class="star-rating">
                                <% for(let i = 1; i <= 5; i++) { %>
                                    <i class="bi <%= i <= review.rating ? 'bi-star-fill' : 'bi-star' %>"></i>
                                <% } %>
                            </div>
                            <div class="review-booking-id">
                                Booking #<%= review.booking_id %>
                            </div>
                        </div>
                    </div>
                    <div class="review-content">
                        <% if (review.review_text) { %>
                            <%= review.review_text %>
                        <% } else { %>
                            <span class="text-muted fst-italic">No comment provided</span>
                        <% } %>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <div class="empty-reviews">
                <i class="bi bi-star"></i>
                <h4>No Reviews Yet</h4>
                <p>You haven't received any reviews yet. As you complete more services, customers will have the opportunity to leave reviews about their experience.</p>
            </div>
        <% } %>
    </div>

    <% if (monthlyStats && monthlyStats.length > 0) { %>
    <!-- Monthly Review Stats -->
    <div class="data-section">
        <h3 class="section-title">
            <i class="bi bi-graph-up"></i> Monthly Review Statistics
        </h3>
        
        <div class="table-responsive">
            <table class="pricing-table">
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Number of Reviews</th>
                        <th>Average Rating</th>
                    </tr>
                </thead>
                <tbody>
                    <% monthlyStats.forEach(stat => { %>
                        <tr>
                            <td>
                                <% 
                                    const [year, month] = stat.month.split('-');
                                    const date = new Date(parseInt(year), parseInt(month)-1, 1);
                                    const monthName = date.toLocaleString('default', { month: 'long' });
                                %>
                                <%= monthName %> <%= year %>
                            </td>
                            <td><%= stat.review_count %></td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <%= parseFloat(stat.average_rating).toFixed(1) %>
                                    <div class="ms-2">
                                        <% for (let i = 1; i <= 5; i++) { %>
                                            <% if (i <= Math.floor(stat.average_rating)) { %>
                                                <i class="bi bi-star-fill text-warning" style="font-size: 0.8rem;"></i>
                                            <% } else if (i <= Math.floor(stat.average_rating) + 0.5 && i > Math.floor(stat.average_rating)) { %>
                                                <i class="bi bi-star-half text-warning" style="font-size: 0.8rem;"></i>
                                            <% } else { %>
                                                <i class="bi bi-star text-warning" style="font-size: 0.8rem;"></i>
                                            <% } %>
                                        <% } %>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
    </div>
    <% } %>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Auto-dismiss alerts after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    });
</script>
</body> </html>
