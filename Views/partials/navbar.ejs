<!-- views/partials/navbar.ejs -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top">
    <div class="container">
        <!-- Logo -->
        <a class="navbar-brand" href="/">
            <i class="bi bi-tools"></i>
            <span class="logo-text">HandyHub</span>
        </a>
        
        <!-- Navbar Toggler for Mobile -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <!-- Navbar Links -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">
                <!-- Main Navigation Links -->
                <li class="nav-item">
                    <a class="nav-link" href="/">About</a>
                </li>
                <li class="nav-item">
                    <% if (locals.user && user) { %>
                        <a class="nav-link" href="/customer/dashboard#services">Services</a>
                    <% } else { %>
                        <a class="nav-link" href="/#services">Services</a>
                    <% } %>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#contact">Contact</a>
                </li>
                
                <!-- Separator before user-related items (visible on larger screens) -->
                <!-- <li class="nav-item d-none d-lg-block">
                    <span class="nav-link nav-separator"></span>
                </li>
                 -->
                <!-- User Authentication Section -->
                <% if (locals.user && user) { %>
                    <!-- User Dropdown - Show when logged in -->
                    <li class="nav-item dropdown user-dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" 
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle"></i> 
                            <span class="ms-1"><%= user.firstName ? user.firstName + ' ' + user.lastName : 'User' %></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li class="dropdown-header">Account</li>
                            <li><a class="dropdown-item" href="/customer/dashboard">
                                <i class="bi bi-speedometer2 me-2"></i>Dashboard
                            </a></li>
                            <li><a class="dropdown-item" href="/customer/bookings">
                                <i class="bi bi-calendar-check me-2"></i>My Bookings
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item logout-item" href="/auth/logout">
                                <i class="bi bi-box-arrow-right me-2"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                <% } else { %>
                    <!-- Login button - Show when not logged in -->
                    <li class="nav-item">
                        <a class="btn btn-login" href="/auth/customer-login">Login</a>
                    </li>
                <% } %>
            </ul>
        </div>
    </div>
</nav>

<!-- Spacer element to prevent content from being hidden beneath fixed navbar -->
<div class="navbar-spacer"></div>

<style>
    :root {
        --primary-blue: #0077be;
        --dark-blue: #003366;
        --light-blue: #e6f2ff;
        --transition-standard: all 0.3s ease;
    }

    /* Navbar Structure Styling */
    .navbar {
        background-color: white !important;
        box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        padding: 15px 0;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1030;
        transition: var(--transition-standard);
    }
    
    .navbar-spacer {
        height: 80px; /* Match navbar height for proper spacing */
    }
    
    /* Logo Styling */
    .navbar-brand {
        display: flex;
        align-items: center;
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--primary-blue);
        padding: 0;
    }

    .navbar-brand i {
        font-size: 1.8rem;
        margin-right: 10px;
        color: var(--primary-blue);
    }
    
    .logo-text {
        color: var(--primary-blue);
        font-weight: bold;
    }
    
    /* Navigation Links Styling */
    .navbar-nav {
        gap: 5px;
    }
    
    .navbar-nav .nav-link {
        color: var(--dark-blue);
        font-weight: 500;
        padding: 8px 15px;
        border-radius: 6px;
        transition: var(--transition-standard);
    }

    .navbar-nav .nav-link:hover {
        color: var(--primary-blue);
        background-color: rgba(0, 119, 190, 0.05);
    }
    
    /* Separator styling */
    .nav-separator {
        height: 24px;
        width: 1px;
        background-color: rgba(0, 0, 0, 0.1);
        padding: 0;
        margin: 0 5px;
    }
    
    /* User Dropdown Styling */
    .user-dropdown .dropdown-toggle {
        display: flex;
        align-items: center;
    }
    
    .user-dropdown .dropdown-toggle::after {
        margin-left: 8px;
    }
    
    .navbar .dropdown-menu {
        border: none;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        border-radius: 10px;
        padding: 8px 0;
        margin-top: 10px;
    }
    
    .navbar .dropdown-header {
        color: var(--primary-blue);
        font-weight: 600;
        font-size: 0.85rem;
        padding: 8px 20px;
        text-transform: uppercase;
    }

    .navbar .dropdown-item {
        padding: 10px 20px;
        color: var(--dark-blue);
        transition: var(--transition-standard);
        border-radius: 0;
    }

    .navbar .dropdown-item:hover {
        background-color: var(--light-blue);
        color: var(--primary-blue);
    }
    
    .navbar .dropdown-item i {
        color: var(--primary-blue);
        opacity: 0.7;
    }
    
    .navbar .dropdown-divider {
        margin: 5px 0;
        opacity: 0.1;
    }
    
    .navbar .logout-item {
        color: #dc3545;
    }
    
    .navbar .logout-item i {
        color: #dc3545;
    }
    
    .navbar .logout-item:hover {
        background-color: rgba(220, 53, 69, 0.1);
        color: #dc3545;
    }

    /* Login Button Styling */
    .navbar .btn-login {
        background-color: var(--primary-blue);
        color: white;
        border-radius: 8px;
        padding: 8px 20px;
        font-weight: 500;
        transition: var(--transition-standard);
    }

    .navbar .btn-login:hover {
        background-color: var(--dark-blue);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Mobile Responsiveness */
    @media (max-width: 991.98px) {
        .navbar-nav {
            padding-top: 1rem;
            gap: 0;
        }
        
        .navbar-nav .nav-link {
            padding: 12px 15px;
        }
        
        .user-dropdown .dropdown-toggle {
            justify-content: flex-start;
        }
        
        .navbar .btn-login {
            margin-top: 8px;
            width: 100%;
            text-align: center;
        }
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add a class to the navbar when scrolling down
    window.addEventListener('scroll', function() {
        const navbar = document.querySelector('.navbar');
        if (window.scrollY > 50) {
            navbar.classList.add('navbar-scrolled');
        } else {
            navbar.classList.remove('navbar-scrolled');
        }
    });

    // For the contact link smooth scrolling
    const contactLink = document.querySelector('.nav-link[href="#contact"]');
    if (contactLink) {
        contactLink.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Find the contact section
            const contactSection = document.getElementById('contact');
            
            // If we're on a page with the contact section
            if (contactSection) {
                // Smooth scroll to the contact section
                contactSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                // If not on a page with contact section, go to home page with #contact anchor
                window.location.href = '/#contact';
            }
        });
    }
    
    // For services link to properly navigate to the services section
    const servicesLink = document.querySelector('.nav-link[href*="#services"]');
    if (servicesLink) {
        servicesLink.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            
            // If we're already on the page containing the services section
            if (window.location.pathname === '/' && href === '/#services' || 
                window.location.pathname === '/customer/dashboard' && href === '/customer/dashboard#services') {
                e.preventDefault();
                
                // Find the services section and scroll to it
                const servicesSection = document.getElementById('services');
                if (servicesSection) {
                    servicesSection.scrollIntoView({ behavior: 'smooth' });
                }
            }
            // Otherwise let the browser navigate to the URL with the anchor
        });
    }
});
</script>